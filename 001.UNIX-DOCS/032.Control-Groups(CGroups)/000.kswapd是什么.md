# kswapd
`kswapd` 是 Linux 内核中的一个**虚拟内存管理守护进程**（Kernel Swap Daemon）。

简单来说，它的任务是作为“内存管家”，在系统内存（RAM）不足时，负责找回一些空间，防止系统因为内存耗尽而崩溃。

---

### 1. 它是如何工作的？

`kswapd` 并不总是在运行。它大部分时间处于休眠状态，只有当系统空闲内存降低到某个**阈值（Watermark）**以下时，它才会被唤醒。

* **回收（Reclaim）：** 它会查看哪些内存页（Pages）最近没怎么被使用。
* **交换（Swap）：** * 如果是“匿名内存”（比如进程运行中的数据），它会把这些数据移动到磁盘上的 **Swap 分区**。
* 如果是“文件缓存”（比如从硬盘读取的代码或文档），它可能会直接释放，因为以后需要时可以从硬盘重新读取。


* **停止：** 一旦空闲内存回升到安全水平，`kswapd` 就会重新进入休眠。

---

### 2. 为什么在 `top` 命令里看到它占用 CPU 高？

如果你发现 `kswapd0`（数字 0 代表第一个 NUMA 节点）的 CPU 使用率很高，通常意味着：

1. **物理内存不足：** 你的程序运行需要的内存超过了实际拥有的 RAM。
2. **内存碎片严重：** 虽然看起来还有空闲内存，但没有足够大的连续空间。
3. **频繁换页（Thrashing）：** 系统在不断地把数据从内存搬到硬盘，又从硬盘搬回内存。这会导致系统变得非常卡顿。

### 3. 核心机制：水位线 (Watermarks)

Linux 为每个内存区域定义了三个水位线：

* **High（高）：** 内存充足，`kswapd` 休眠。
* **Low（低）：** `kswapd` 被唤醒，开始后台回收内存。
* **Min（极低）：** 内存非常危险。此时系统会执行“直接回收”（Direct Reclaim），即让请求内存的进程自己去清理空间，这会导致明显的应用延迟。

---

### 总结

`kswapd` 是系统为了**维持流畅度**而设置的预警和处理机制。它存在的目的是在内存真正耗尽之前，通过后台调度提前腾出空间。

**你是发现服务器 CPU 被这个进程占满了，还是在学习内核相关的知识？** 如果是前者，我可以教你如何查看内存压力分布或调整内核参数。