# slab
> 学习:[Run Linux Kernel (2nd Edition) Volume 1: Infrastructure.epub]#4.2　slab分配器

## 背景
内核常常需要分配几十字节的小内存块，若为其分配一个物理页面，则非常浪费内存。而slab就是管理一块内存，`预留好空间`，当需要为变量分配内存时，直接通过slab中获取。

## slab组织方式&数据结构
+ slab描述符：kmem_cache(000.LINUX-5.9/include/linux/slab_def.h)
+ 创建slab描述符: kmem_cache_create (mm/slab_common.c) <sup>在这个函数中，尚未给slab分配器分配物理页面</sub>
  - 创建流程
  - 内存布局
   ```c
    // 伪代码如下

    // 创建 task_struct 专用的 slab cache
    struct kmem_cache *  task_struct_cachep = kmem_cache_create("task_struct",
                        arch_task_struct_size,          // 架构相关的对象大小
                        ARCH_MIN_TASKALIGN,            // 对齐要求
                        SLAB_PANIC | SLAB_ACCOUNT,     // 标志：失败时 panic + 内存记账
                        NULL);                         // 无构造函数
    // 则，后续需要为进程分配 task_struct时，直接从该salb中分配即可
   ```
