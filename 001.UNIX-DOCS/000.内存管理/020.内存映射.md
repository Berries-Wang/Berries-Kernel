# 内存映射
在Linux内核中，虚拟地址和物理地址之间是如何映射的，与开启MMU后又有什么变化?
## 内存映射方式
|内存映射方式|简要|场景|备注|
|-|-|-|-|
|恒等映射(Identity Mapping)|- pa = va (物理地址 与 虚拟地址相等)<br/>|- 内核初始化页表 <br/>|- 开启MMU后，CPU就只能处理虚拟内存了，如果没有恒等映射，地址映射会有问题 <br/>|
|-|-|-|-|
|直接映射(线性映射)(Linear Mapping / Direct Mapping)|- 虚拟地址和物理地址之间存在一个固定的偏移量<sup>**内核建立页表时会算出来**</sup>,虚拟地址和物理地址的转换可以直接通过简单的加减法来转换，而不用通过复杂的页表转换<br/>|- 页表遍历 <sup>因页表项中存储的是物理地址，且此时开启了MMU，CPU只能接受虚拟地址，因此，只能将物理地址通过固定的偏移量转为虚拟地址，再由CPU处理</sup><br/>|- [Run Linux Kernel (2nd Edition) Volume 1: Infrastructure.epub#2.7.2　软件遍历页表](../../007.BOOKs/Run%20Linux%20Kernel%20(2nd%20Edition)%20Volume%201:%20Infrastructure.epub) : "在PGD页表项中存储了指向下一级页表基地址的物理地址，因此通过__va()宏，可以快速地把物理地址转换成内核空间的虚拟地址，从而找到下一级页表基地址的虚拟地址"</sup><br/>|
|-|-|-|-|
|-|-|-|-|
