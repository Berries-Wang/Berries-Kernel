# 中断管理
> 先阅读:[Run Linux Kernel (2nd Edition) Volume 2: Debugging and Case Analysis.epub]#第2章　中断管理

Linux内核支持众多的处理器架构，因此从系统角度来看，Linux内核的中断管理可以分成如下4层。
- 硬件层，如CPU和中断控制器的连接。
- 处理器架构管理层，如CPU中断异常处理。
- 中断控制器管理层，如IRQ号的映射。
- Linux内核通用中断处理器层，如中断注册和中断处理。


## 中断处理程序
### 中断处理程序为什么分为上半部分和下半部分
当一个外设中断发生后，内核会执行一个函数来响应该中断，这个函数通常称为中断处理程序（interrupt handler）或中断服务例程。中断处理程序是内核用于响应中断的<sub>中断处理程序包括硬件中断处理程序及其下半部处理机制，包括中断线程化、软中断、tasklet以及工作队列等，这里特指硬件中断处理程序。</sub>，并且运行在中断上下文中（和进程上下文不同）。中断处理程序最基本的工作是通知硬件设备中断已经被接收，不同的硬件设备的中断处理程序是不同的，有的常常需要做很多的处理工作，这也`是Linux内核把中断处理程序分成上半部和下半部的原因`

中断处理程序要求快速完成并且退出中断，但是如果中断处理程序需要完成的任务比较繁重，这两个需求就会有冲突，因此上下半部机制就诞生了。

中断上半部有一个很重要的原则——硬件中断处理程序应该执行得越快越好，即希望它尽快离开并从硬件中断返回,原因如下:
- 硬件中断处理程序以异步方式执行，它会中断其他重要代码的执行，因此为了避免中断的程序停止时间太长，硬件中断处理程序必须尽快执行完。
- 硬件中断处理程序通常在关中断的情况下执行。所谓的关中断是指关闭了本地CPU的所有中断响应。关中断之后，本地CPU不能再响应中断，因此硬件中断处理程序必须尽快执行完。以ARM处理器为例，中断发生时，ARM处理器会自动关闭本地CPU的IRQ/FIQ，直到从中断处理程序退出时才打开本地中断，整个过程都处于关中断状态。

##### ---> 上半部分 <sup>划分: [Run Linux Kernel (2nd Edition) Volume 2: Debugging and Case Analysis.epub]#2.6　软中断和tasklet</sup>
上半部分一般就是 中断处理程序  (硬件中断处理)

##### ---> 下半部分
如软中断请求、tasklet和工作队列等 , 且 中断线程化属于下半部的范畴

### 软中断
